<div id="compare-items">
    <table id="compare-table">
      <thead>
        <tr>
          <th>Product Image</th>
          <th>Product Name</th>
          <th>Price</th>
          <th>Size</th>
          {% comment %} <th>Custom Field</th> {% endcomment %}
        </tr>
      </thead>
      <tbody id="compare-table-body"></tbody>
    </table>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Fetch compare items from localStorage
      const compareProducts = JSON.parse(localStorage.getItem('compareProducts')) || [];
  
      if (compareProducts.length > 0) {
        fetch('/products.json')
          .then(response => response.json())
          .then(data => {
            const products = data.products.filter(product => compareProducts.includes(product.handle));
            const tableBody = document.getElementById('compare-table-body');
            tableBody.innerHTML = '';
  
            products.forEach(product => {
              let sizes = [];
              if (product.options && product.options.length > 0 &&
                  !(product.options.length === 1 && product.options[0].name === "Title" &&
                  product.options[0].values.length === 1 && product.options[0].values[0] === "Default Title")) {
                product.variants.forEach(variant => {
                  if (variant.option1 && !sizes.includes(variant.option1)) {
                    sizes.push(variant.option1);
                  }
                });
              }
              const sizeString = sizes.length > 0 ? sizes.join(', ') : 'N/A';
              {% comment %} const customField = product.metafields?.custom?.field_name || 'N/A'; {% endcomment %}
  
              const row = document.createElement('tr');
              row.innerHTML = `
                <td><a href="/products/${product.handle}"><img src="${product.images[0].src}" alt="${product.title}" style="max-width: 100px;"></a></td>
                <td><a href="/products/${product.handle}">${product.title}</a></td>
                <td>${product.variants[0].price} ${Shopify.currency.active}</td>
                <td>${sizeString}</td>
                {% comment %} <td>${customField}</td> {% endcomment %}
              `;
              tableBody.appendChild(row);
            });
          })
          .catch(error => {
            console.error('Error fetching product data:', error);
            document.getElementById('compare-items').innerHTML = '<p>Error fetching product data. Please try again later.</p>';
          });
      } else {
        document.getElementById('compare-items').innerHTML = '<p>No products added to compare.</p>';
      }
    });
  </script>
  
  <style>
    #compare-items {
      margin-top: 20px;
    }
  
    #compare-table {
      width: 100%;
      border-collapse: collapse;
    }
  
    #compare-table th, #compare-table td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: left;
    }
  
    #compare-table th {
      background-color: #f4f4f4;
    }
  
    #compare-table td img {
      display: block;
      margin: auto;
      max-width: 100px;
      max-height: 100px;
    }
  
    #compare-table a {
      color: inherit; /* Ensures that the link inherits the color of the surrounding text */
      text-decoration: none; /* Removes the underline from the links */
    }
  
    #compare-table a:hover {
      text-decoration: underline; /* Adds an underline on hover for better accessibility */
    }
  </style>
  