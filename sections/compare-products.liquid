<div id="compare-items">
    <table id="compare-table">
      <thead>
        <tr>
          <th>Product Image</th>
          <th>Product Name</th>
          <th>Price</th>
          <th>Size</th>
          {% comment %} <th>Custom Field</th> {% endcomment %}
        </tr>
      </thead>
      <tbody id="compare-table-body"></tbody>
    </table>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Fetch compare items from localStorage
      const compareProducts = JSON.parse(localStorage.getItem('compareProducts')) || [];
  
      if (compareProducts.length > 0) {
        fetch('/products.json') // Assuming this endpoint returns product data
          .then(response => response.json())
          .then(data => {
            const products = data.products.filter(product => compareProducts.includes(product.handle));
            const tableBody = document.getElementById('compare-table-body');
            tableBody.innerHTML = ''; // Clear existing content
  
            products.forEach(product => {
              const variant = product.variants[0]; // Assuming the first variant for simplicity
              let size = 'N/A'; // Default size value
              if (product.options && product.options.length > 0 &&
                  !(product.options.length === 1 && product.options[0].name === "Title" &&
                  product.options[0].values.length === 1 && product.options[0].values[0] === "Default Title")) {
                size = variant.option1 || 'N/A'; // Use variant option1 as size
              }
              const customField = product.metafields?.custom?.field_name || 'N/A'; // Replace with actual metafield path
  
              const row = document.createElement('tr');
              row.innerHTML = `
                <td><img src="${product.images[0].src}" alt="${product.title}" style="max-width: 100px;"></td>
                <td>${product.title}</td>
                <td>${variant.price} ${Shopify.currency.active}</td>
                <td>${size}</td>
                <td>${customField}</td>
              `;
              tableBody.appendChild(row);
            });
          })
          .catch(error => {
            console.error('Error fetching product data:', error);
            document.getElementById('compare-items').innerHTML = '<p>Error fetching product data. Please try again later.</p>';
          });
      } else {
        document.getElementById('compare-items').innerHTML = '<p>No products added to compare.</p>';
      }
    });
  </script>
  
  <style>
    #compare-items {
      margin-top: 20px;
    }
  
    #compare-table {
      width: 100%;
      border-collapse: collapse;
    }
  
    #compare-table th, #compare-table td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: left;
    }
  
    #compare-table th {
      background-color: #f4f4f4;
    }
  
    #compare-table td img {
      display: block;
      margin: auto;
      max-width: 100px;
      max-height: 100px;
    }
  </style>
  